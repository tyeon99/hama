<!-- eslint-disable vue/attribute-hyphenation -->
<template>
  <div class="messagesContent">
    <div class="messagesContent__state">
      <img width="16" src="~/assets/img/chat/calling/state-img.png">
      <span :class="zoomClass">모의체험 중</span>
    </div>
    <div class="messagesContent__chat">
      <div class="aiChat">
        <p :class="zoomClass">고객님 안녕하세요 정부지원 대출 상담원 박대출 이올시다.</p>
      </div>
      <div class="userChat">
        <p :class="zoomClass">우리딸이라며?</p>
      </div>
      <div class="aiChat img">
        <p>
          <button @click="openChatImgModal(require('~/assets/img/chat/calling/ex-img01.png'))">
            <img src="~/assets/img/chat/calling/ex-img01.png" alt="예시 이미지01">
          </button>
        </p>
      </div>
      <div class="aiChat link">
        <p :class="zoomClass">
          <button @click="openChatImgModal(require('~/assets/img/chat/calling/ex-img02.png'))">
            대법원사건조회.kr
          </button>
        </p>
      </div>
      <div class="aiChat">
        <p :class="zoomClass">
          ...
          <img width="16" src="~/assets/img/common/chat_end-icon.png">
        </p>
      </div>
    </div>

    <!-- UI 버튼 모음 -->
    <div class="showButton">
      <button @click="openChatVoiceAnimation">음성입력</button>
      <button @click="openChatChoiceOffcanvas">답변선택</button>
      <button @click="openChatKeypadOffcanvas">키패드</button>
      <button @click="openChatNumOverOffcanvas">횟수초과</button>
      <button @click="openChatTimeOutWarning">타임아웃경고</button>
      <button @click="openChatTimeOutEndModal">타임아웃종료</button>
    </div>

    <!-- 이미지 모달 -->
    <ChatImgModal 
      v-if="isChatImgModalOpen"
      :isModalAni="isModalAni"
      :modalImgSrc="modalImgSrc"
      @close-chatImgModal="closeChatImgModal"
    />

    <!-- 음성 입력 애니메이션 -->
    <ChatVoiceAnimation 
      v-if="isChatVoiceAnimationOpen"
      :isModalAni="isModalAni"
    />

    <!-- 답변 선택창 -->
    <ChatChoiceOffcanvas
      v-if="isChatChoiceOffcanvasOpen"
      :isOffcanvasAni="isOffcanvasAni"
      @close-chatChoiceOffcanvas="closeChatChoiceOffcanvas"
    />

    <!-- 보안키패드 -->
    <ChatKeypadOffcanvas
      v-if="isChatKeypadOffcanvasOpen"
      :isOffcanvasAni="isOffcanvasAni"
      @close-chatKeypadOffcanvas="closeChatKeypadOffcanvas"
    />

    <!-- 관계없는 발화 횟수 초과 종료 알림 -->
    <ChatNumOverOffcanvas
      v-if="isChatNumOverOffcanvasOpen"
      :isOffcanvasAni="isOffcanvasAni"
      @close-chatNumOverOffcanvas="closeChatNumOverOffcanvas"
    />

    <!-- 타임아웃 경고 -->
    <ChatTimeOutWarning 
      v-if="isChatTimeOutWarningOpen"
      :isOffcanvasAni="isOffcanvasAni"
    />

    <!-- 타임아웃 종료 -->
    <ChatTimeOutEndModal 
      v-if="isChatTimeOutEndModalOpen"
      :isOffcanvasAni="isOffcanvasAni"
    />
  </div>
</template>

<script>
import ChatImgModal from '~/components/chat/common/ChatImgModal'
import ChatVoiceAnimation from '~/components/chat/common/ChatVoiceAnimation'
import ChatChoiceOffcanvas from '~/components/chat/common/ChatChoiceOffcanvas'
import ChatKeypadOffcanvas from '~/components/chat/common/ChatKeypadOffcanvas'
import ChatNumOverOffcanvas from '~/components/chat/common/ChatNumOverOffcanvas'
import ChatTimeOutWarning from '~/components/chat/common/ChatTimeOutWarning'
import ChatTimeOutEndModal from '~/components/chat/common/ChatTimeOutEndModal'

export default {
  components: {
    ChatImgModal,
    ChatVoiceAnimation,
    ChatChoiceOffcanvas,
    ChatKeypadOffcanvas,
    ChatNumOverOffcanvas,
    ChatTimeOutWarning,
    ChatTimeOutEndModal
  },
  data() {
    return {
      isOffcanvasAni: false,
      isChatImgModalOpen: false,
      isChatVoiceAnimationOpen: false,
      isChatChoiceOffcanvasOpen: false,
      isChatKeypadOffcanvasOpen: false,
      isChatNumOverOffcanvasOpen: false,
      isChatTimeOutWarningOpen: false,
      isChatTimeOutEndModalOpen: false,
      modalImgSrc: null,
      isModalAni: 'animate__zoomIn'
    }
  },
  computed: {
    fontSizePercent () {
      return this.$store.state.font.fontSizePercent
    },
    zoomClass () {
      if (this.fontSizePercent === 130) return 'zoom-13'
      if (this.fontSizePercent === 120) return 'zoom-12'
      if (this.fontSizePercent === 110) return 'zoom-11'
      if (this.fontSizePercent === 90) return 'zoom-09'
      if (this.fontSizePercent === 80) return 'zoom-08'
      if (this.fontSizePercent === 70) return 'zoom-07'
      return ''
    }
  },
  methods: {
    // 이미지, 링크 열고 닫기기
    openChatImgModal(src) {
      this.modalImgSrc = src
      this.isModalAni = 'animate__zoomIn'
      this.isChatImgModalOpen = true
    },
    closeChatImgModal() {
      this.isModalAni = 'animate__zoomOut'

      setTimeout(() => {
        this.isChatImgModalOpen = false
        this.modalImgSrc = null
      }, 300)
    },

    // 음성 인식 애니메이션 열고 닫기
    openChatVoiceAnimation() {
      this.isModalAni = 'animate__zoomIn'
      this.isChatVoiceAnimationOpen = true
    },
    closeChatVoiceAnimation() {
      this.isModalAni = 'animate__zoomOut'

      setTimeout(() => {
        this.isChatVoiceAnimationOpen = false
      }, 300)
    },

    // 답변 선택창 열고 닫기
    openChatChoiceOffcanvas () {
      this.isOffcanvasAni = true
      this.isChatChoiceOffcanvasOpen = true
    },
    closeChatChoiceOffcanvas () {
      this.isOffcanvasAni = false
      setTimeout(() => {
        this.isChatChoiceOffcanvasOpen = false
      }, 300)
    },

    // 보안 키패드 열고 닫기
    openChatKeypadOffcanvas () {
      this.isOffcanvasAni = true
      this.isChatKeypadOffcanvasOpen = true
    },
    closeChatKeypadOffcanvas () {
      this.isOffcanvasAni = false
      setTimeout(() => {
        this.isChatKeypadOffcanvasOpen = false
      }, 300)
    },

    // 관계없는 발화 횟수 초과 종료 알림창 열고 닫기
    openChatNumOverOffcanvas () {
      this.isOffcanvasAni = true
      this.isChatNumOverOffcanvasOpen = true
    },
    closeChatNumOverOffcanvas () {
      this.isOffcanvasAni = false
      setTimeout(() => {
        this.isChatNumOverOffcanvasOpen = false
      }, 300)
    },

    // 타임아웃 경고 열고 닫기
    openChatTimeOutWarning () {
      this.isOffcanvasAni = true
      this.isChatTimeOutWarningOpen = true
    },
    closeChatTimeOutWarning () {
      this.isOffcanvasAni = false
      setTimeout(() => {
        this.isChatTimeOutWarningOpen = false
      }, 300)
    },

    // 타임아웃 종료 열고 닫기
    openChatTimeOutEndModal () {
      this.isOffcanvasAni = true
      this.isChatTimeOutEndModalOpen = true
    },
    closeChatTimeOutEndModal () {
      this.isOffcanvasAni = false
      setTimeout(() => {
        this.isChatTimeOutEndModalOpen = false
      }, 300)
    }
  }
}
</script>

<style scoped>
.messagesContent{
  @apply w-full h-[100dvh] px-[16px] overflow-y-auto pt-[74px] pb-[166px] bg-[url(~/assets/img/chat/messages/messages-bg.png)] bg-cover bg-center bg-no-repeat;
}
.messagesContent__state{
  @apply w-fit m-[0_auto] flex justify-center items-center gap-[8px] p-[6px_20px] bg-[rgba(21,21,83,0.4)] rounded-[16px] mb-[20px];
}
.messagesContent__state span{
  @apply font-semibold text-[13px] leading-[16px] text-[#fff];
}
.messagesContent__chat{
  @apply w-full flex flex-col justify-start items-start gap-[20px];
}
.messagesContent__chat .aiChat{
  @apply w-full pr-[28px] flex justify-start items-center;
}
.messagesContent__chat .aiChat p{
  @apply relative bg-[#fff] p-[16px_24px] rounded-[16px] font-medium text-[16px] leading-[19px] text-[#2B2436] shadow-[0px_0px_12px_0px_rgba(0,0,0,0.08)] flex justify-start items-center before:content-[''] before:absolute before:w-[20.72px] before:h-[34.64px] before:bottom-0 before:left-[-7.72px] before:bg-[url(~/assets/img/chat/calling/aiChat-tail.png)] before:bg-cover before:bg-center before:bg-no-repeat;
}
.messagesContent__chat .aiChat.img p{
  @apply p-0 max-w-[250px] rounded-none bg-transparent before:content-none
}
.messagesContent__chat .aiChat.link p{
  @apply text-[#2687F5];
}
.messagesContent__chat .userChat{
  @apply w-full pl-[28px] flex justify-end items-center;
}
.messagesContent__chat .userChat p{
  @apply relative bg-[#7074A7] p-[16px_24px] rounded-[16px] font-medium text-[16px] leading-[19px] text-[#fff] shadow-[0px_0px_12px_0px_rgba(0,0,0,0.08)] after:content-[''] after:absolute after:w-[20.72px] after:h-[34.64px] after:bottom-0 after:right-[-7.72px] after:bg-[url(~/assets/img/chat/messages/userChat-tail.png)] after:bg-cover after:bg-center after:bg-no-repeat;
}
</style>